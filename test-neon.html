<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Neon Database</title>
    <style>
        * { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: #1a1a2e; color: #eee; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #4ecca3; text-align: center; }
        .test-box { background: #16213e; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #4ecca3; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #2ecc71; color: white; }
        .error { background: #e74c3c; color: white; }
        .loading { background: #f39c12; color: white; }
        button { background: #4ecca3; color: white; border: none; padding: 15px 30px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px; }
        button:hover { background: #3da88a; }
        pre { background: #0f0f0f; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .result { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Neon PostgreSQL</h1>
        
        <div class="test-box">
            <h2>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:</h2>
            <button onclick="testUsers()">1ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
            <button onclick="testClinics()">2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</button>
            <button onclick="testPatients()">3ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø±Ø¶Ù‰</button>
            <button onclick="addTestClinic()">â• Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
            <button onclick="addTestPatient()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶ ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
        </div>

        <div id="status" class="status loading" style="display:none;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        <div id="result" class="result"></div>
    </div>

    <script type="module">
        import { pgUsers, pgClinics, pgPatients } from './services/pgServices.ts';

        window.testUsers = async function() {
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            
            statusDiv.style.display = 'block';
            statusDiv.className = 'status loading';
            statusDiv.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Neon...';
            
            try {
                const users = await pgUsers.getAll();
                statusDiv.className = 'status success';
                statusDiv.textContent = `âœ… ØªÙ… Ø¬Ù„Ø¨ ${users.length} Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!`;
                
                resultDiv.innerHTML = '<h3>ğŸ“‹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:</h3><pre>' + 
                    JSON.stringify(users, null, 2) + '</pre>';
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message;
                resultDiv.innerHTML = '<pre>' + error.stack + '</pre>';
            }
        };

        window.testClinics = async function() {
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            
            statusDiv.style.display = 'block';
            statusDiv.className = 'status loading';
            statusDiv.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª Ù…Ù† Neon...';
            
            try {
                const clinics = await pgClinics.getAll();
                statusDiv.className = 'status success';
                statusDiv.textContent = `âœ… ØªÙ… Ø¬Ù„Ø¨ ${clinics.length} Ø¹ÙŠØ§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!`;
                
                resultDiv.innerHTML = '<h3>ğŸ¥ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª:</h3><pre>' + 
                    JSON.stringify(clinics, null, 2) + '</pre>';
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message;
                resultDiv.innerHTML = '<pre>' + error.stack + '</pre>';
            }
        };

        window.testPatients = async function() {
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            
            statusDiv.style.display = 'block';
            statusDiv.className = 'status loading';
            statusDiv.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ù…Ù† Neon...';
            
            try {
                const patients = await pgPatients.getAll();
                statusDiv.className = 'status success';
                statusDiv.textContent = `âœ… ØªÙ… Ø¬Ù„Ø¨ ${patients.length} Ù…Ø±ÙŠØ¶ Ø¨Ù†Ø¬Ø§Ø­!`;
                
                resultDiv.innerHTML = '<h3>ğŸ‘¥ Ø§Ù„Ù…Ø±Ø¶Ù‰:</h3><pre>' + 
                    JSON.stringify(patients, null, 2) + '</pre>';
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message;
                resultDiv.innerHTML = '<pre>' + error.stack + '</pre>';
            }
        };

        window.addTestClinic = async function() {
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            
            statusDiv.style.display = 'block';
            statusDiv.className = 'status loading';
            statusDiv.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©...';
            
            try {
                const id = await pgClinics.create({
                    name: 'Ø¹ÙŠØ§Ø¯Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© ' + new Date().getTime(),
                    type: 'Test Clinic',
                    category: 'clinic',
                    active: true,
                    isArchived: false
                });
                
                statusDiv.className = 'status success';
                statusDiv.textContent = `âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­! ID: ${id}`;
                
                // Refresh clinics
                const clinics = await pgClinics.getAll();
                resultDiv.innerHTML = '<h3>ğŸ¥ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</h3><pre>' + 
                    JSON.stringify(clinics, null, 2) + '</pre>';
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ ÙØ´Ù„Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ' + error.message;
                resultDiv.innerHTML = '<pre>' + error.stack + '</pre>';
            }
        };

        window.addTestPatient = async function() {
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            
            statusDiv.style.display = 'block';
            statusDiv.className = 'status loading';
            statusDiv.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶ ØªØ¬Ø±ÙŠØ¨ÙŠ...';
            
            try {
                const id = await pgPatients.create({
                    name: 'Ù…Ø±ÙŠØ¶ ØªØ¬Ø±ÙŠØ¨ÙŠ ' + new Date().getTime(),
                    phone: '0799999999',
                    email: 'test@test.com',
                    password: 'test123',
                    medicalProfile: {},
                    currentVisit: {
                        visitId: '',
                        clinicId: '',
                        date: Date.now(),
                        status: 'waiting',
                        priority: 'normal',
                        reasonForVisit: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…'
                    },
                    history: [],
                    isArchived: false
                });
                
                statusDiv.className = 'status success';
                statusDiv.textContent = `âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¨Ù†Ø¬Ø§Ø­! ID: ${id}`;
                
                // Refresh patients
                const patients = await pgPatients.getAll();
                resultDiv.innerHTML = '<h3>ğŸ‘¥ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</h3><pre>' + 
                    JSON.stringify(patients, null, 2) + '</pre>';
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ ÙØ´Ù„Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ' + error.message;
                resultDiv.innerHTML = '<pre>' + error.stack + '</pre>';
            }
        };

        // Auto-test on load
        window.addEventListener('load', () => {
            console.log('ğŸš€ ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø§Ù‡Ø²Ø©!');
            console.log('DATABASE_URL:', import.meta.env.DATABASE_URL || 'Using default from db.ts');
        });
    </script>
</body>
</html>
